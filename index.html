<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PRPSA Quiz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6f0ff;
      padding: 20px;
      color: #003366;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 51, 102, 0.2);
    }
    .question {
      font-size: 20px;
      margin-bottom: 30px;
    }
    .options {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
    }
    .options button {
      flex: 1;
      min-width: 120px;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }
    .options button:hover {
      background-color: #0056b3;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
    }
    .navigation button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #0056b3;
      color: white;
      border: none;
      border-radius: 5px;
    }
    .navigation button:disabled {
      background-color: #999;
    }
    .progress-bar {
      height: 20px;
      background: #cce0ff;
      margin-top: 20px;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: #007bff;
      width: 0%;
      transition: width 0.3s ease-in-out;
    }
    .result {
      font-size: 18px;
      text-align: center;
      margin-top: 30px;
    }
    canvas {
      margin-top: 40px;
      display: block;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #reminder {
      text-align: center;
      color: #007bff;
      font-weight: bold;
      margin-top: 20px;
      min-height: 1.2em;
    }
    #welcomePage {
      text-align: center;
    }
    #welcomePage p {
      font-size: 18px;
      margin-bottom: 30px;
    }
    #welcomePage button {
      padding: 12px 30px;
      font-size: 18px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #welcomePage button:hover {
      background-color: #0056b3;
    }
    #restartBtn {
      margin: 20px auto;
      padding: 12px 30px;
      font-size: 18px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: block;
      max-width: 220px;
    }
    #restartBtn:hover {
      background-color: #0056b3;
    }
    .footnote {
      font-size: 12px;
      color: #666;
      text-align: center;
      margin-top: 40px;
    }
    /* Smaller legend style */
    #legend {
      max-width: 600px;
      margin: 20px auto 0 auto;
      font-size: 14px;
      color: #003366;
      display: flex;
      justify-content: center;
      gap: 20px;
      align-items: center;
    }
    #legend .color-box {
      width: 16px;
      height: 16px;
      background-color: rgba(0, 123, 255, 0.25);
      border: 1px solid rgba(0, 123, 255, 1);
      border-radius: 3px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Modified Personal Report of Public Speaking Anxiety (PRPSA)</h1>

    <div id="welcomePage">
      <p>Welcome to the PRPSA survey.<br><br>
         This survey measures your public speaking anxiety and points at what stage of the speech preparation process you most feel the onset of this anxiety. The stages are based on O'Hair et al.'s (2022) work on the four stages of public speaking anxiety — <strong>pre-preparation</strong> (knowing you will give a speech), <strong>preparation</strong> (choosing a topic, writing an outline, practicing, etc.), <strong>pre-performance</strong> (moments before the speech), <strong>performance</strong> (actual speech).<br><br>
         Please answer all questions honestly.<br><br>
         Click "Next" when you are ready to begin.
      </p>
      <button id="startBtn">Next</button>
    </div>

    <div id="quiz" style="display:none;">
      <div class="question" id="questionText"></div>
      <div class="options" id="optionsContainer"></div>
      <div class="navigation">
        <button onclick="goBack()" id="prevBtn">Previous</button>
      </div>
      <div id="reminder"></div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div id="result" class="result"></div>

    <div id="legend" style="display:none;">
      <div><span class="color-box"></span>Blue area = Your level of anxiety in each stage</div>
      <div><strong>Score Interpretation:</strong> High ≥ 132 | Moderate 98-131 | Low ≤ 97</div>
    </div>

    <canvas id="radarChart" width="400" height="400" style="display:none;"></canvas>
    <button id="restartBtn" style="display:none;">Take survey again</button>

    <!-- Footnote -->
    <p class="footnote">
      Adapted from McCroskey (1970). Measures of communication-bound anxiety. <em>Speech Monographs, 37</em>, 269-277.<br>
      Modified by Villacastin, J.N. & Song, C. (2025) for COMG 251 students from the University of Hawai'i at Mānoa.
    </p>
  </div>

  <script>
    const questions = [
      "I get nervous when I think about speaking in front of a group.",
      "I have trouble sleeping the night before a speech.",
      "I worry about forgetting what I want to say during a speech.",
      "I feel confident when giving a speech.",
      "I get anxious just thinking about giving a speech.",
      "I find myself worrying about a speech days before it happens.",
      "I feel tense and nervous while waiting to speak.",
      "Even when I am well prepared, I feel anxious about giving a speech.",
      "Knowing I have to give a speech makes me feel stressed.",
      "My mind goes blank during a speech.",
      "I feel calm when delivering a speech.",
      "I avoid classes or situations where I might have to speak in front of others.",
      "I feel overwhelmed right before starting a speech.",
      "I am afraid the audience will not understand me.",
      "I get shaky hands or a shaky voice before a speech.",
      "I feel like my heart is racing when I begin a speech.",
      "I wish I could avoid giving speeches altogether.",
      "I find it difficult to concentrate before speaking.",
      "I feel relaxed before giving a speech.",
      "I get upset when I know I’ll have to give a speech.",
      "My thoughts become jumbled during a speech.",
      "I feel in control when I give a speech.",
      "I get distracted easily during a speech.",
      "I worry about looking foolish during a speech.",
      "I get headaches or feel physically ill before a speech.",
      "I would do almost anything to avoid giving a speech.",
      "I rehearse over and over but still feel unprepared.",
      "I feel like I’ll embarrass myself during the speech.",
      "I get tongue-tied in front of an audience.",
      "I struggle to breathe evenly when speaking publicly.",
      "The closer it gets to the speech, the worse I feel.",
      "I feel composed when I speak publicly.",
      "I lose track of my main points when speaking.",
      "I worry people are judging how nervous I look.",
      "I feel helpless when speaking in front of others."
    ];

    const step1Indexes = [0,1,2,4,8,9,12,13,18,19,20,21,22,23,26,27,28,29,30,31,32,33];
    const step2Indexes = [3,5,6,7,10,11,14,15,16,17,24,25];

    const subscales = {
      Preprep: [1, 4, 5, 7, 8, 27],
      Prep: [0, 11, 17],
      Preperf: [6, 14, 18, 20, 24, 25, 30, 32],
      Perf: [2,3,9,10,12,13,15,16,19,21,22,23,26,28,29,31,33]
    };

    const labelMap = {
      Preprep: "Pre-preparation",
      Prep: "Preparation",
      Preperf: "Pre-performance",
      Perf: "Performance"
    };

    let currentQuestion = 0;
    let answers = new Array(questions.length).fill(null);

    function renderQuestion() {
      document.getElementById("questionText").textContent = `${currentQuestion + 1}. ${questions[currentQuestion]}`;
      const container = document.getElementById("optionsContainer");
      container.innerHTML = "";
      for (let i = 1; i <= 5; i++) {
        const btn = document.createElement("button");
        btn.innerHTML = `${["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"][i - 1]}<br>(${i})`;
        btn.onclick = () => {
          answers[currentQuestion] = i;
          [...container.children].forEach(b => b.style.opacity = "1");
          btn.style.opacity = "0.6";
          if (currentQuestion === questions.length - 1) {
            calculateResults();
          } else {
            currentQuestion++;
            renderQuestion();
          }
        };
        if (answers[currentQuestion] === i) btn.style.opacity = "0.6";
        container.appendChild(btn);
      }
      document.getElementById("prevBtn").disabled = currentQuestion === 0;
      updateProgressBar();

      const reminder = document.getElementById("reminder");
      if (currentQuestion === questions.length - 1) {
        reminder.textContent = "You are on the last question.";
      } else {
        reminder.textContent = "";
      }
    }

    function goBack() {
      if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion();
      }
    }

    function updateProgressBar() {
      const progressPercent = ((currentQuestion) / questions.length) * 100;
      document.getElementById("progressFill").style.width = `${progressPercent}%`;
    }

    function calculateResults() {
      if (answers.includes(null)) {
        alert("Please answer all questions.");
        return;
      }

      // Show result container and hide quiz
      document.getElementById("quiz").style.display = "none";
      document.getElementById("legend").style.display = "flex";
      document.getElementById("radarChart").style.display = "block";
      document.getElementById("restartBtn").style.display = "block";

      // Total score
      const totalScore = answers.reduce((a,b) => a + b, 0);

      // Calculate subscale sums
      const scores = {};
      for (const [key, indices] of Object.entries(subscales)) {
        scores[key] = indices.reduce((sum, idx) => sum + answers[idx], 0);
      }

      // Calculate max for radar chart to normalize
      const maxPossiblePerSubscale = {};
      for (const key in subscales) {
        maxPossiblePerSubscale[key] = subscales[key].length * 5;
      }

      // Prepare data for radar chart
      const labels = Object.keys(scores).map(k => labelMap[k]);
      const dataValues = Object.keys(scores).map(k => (scores[k]/maxPossiblePerSubscale[k]) * 100);

      // Interpretation text
      let interpretation = "";
      if (totalScore >= 132) interpretation = "High public speaking anxiety.";
      else if (totalScore >= 98) interpretation = "Moderate public speaking anxiety.";
      else interpretation = "Low public speaking anxiety.";

      document.getElementById("result").innerHTML = `
        <strong>Total Score:</strong> ${totalScore} <br>
        <strong>Interpretation:</strong> ${interpretation}
      `;

      // Create radar chart
      const ctx = document.getElementById("radarChart").getContext("2d");
      if(window.radarChartInstance) {
        window.radarChartInstance.destroy();
      }
      window.radarChartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [{
            label: "Your anxiety level (%)",
            data: dataValues,
            fill: true,
            backgroundColor: 'rgba(0, 123, 255, 0.25)',
            borderColor: 'rgba(0, 123, 255, 1)',
            pointBackgroundColor: 'rgba(0, 123, 255, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(0, 123, 255, 1)'
          }]
        },
        options: {
          scales: {
            r: {
              beginAtZero: true,
              max: 100,
              ticks: {
                stepSize: 20,
                color: '#003366',
                backdropColor: 'transparent'
              },
              pointLabels: {
                color: '#003366',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              grid: {
                color: '#a6c8ff'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.formattedValue}% anxiety`
              }
            }
          }
        }
      });
    }

    document.getElementById("startBtn").onclick = () => {
      document.getElementById("welcomePage").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      renderQuestion();
    };

    document.getElementById("restartBtn").onclick = () => {
      answers = new Array(questions.length).fill(null);
      currentQuestion = 0;
      document.getElementById("result").textContent = "";
      document.getElementById("quiz").style.display = "block";
      document.getElementById("legend").style.display = "none";
      document.getElementById("radarChart").style.display = "none";
      document.getElementById("restartBtn").style.display = "none";
      renderQuestion();
    };
  </script>
</body>
</html>
